<%- include('../../partials/main', { pageTitle: 'Reports' }) %>

<style>
    .inline{
        display: inline-flex;
    }
    #select2-product-container , #select2-unit-container{
        font-size: calc(14px + (16 - 14) * ((100vw - 320px) / (1920 - 320)));
    }
        .mb-4{
            justify-content: space-evenly;
        }
        .completebutton{
            align-items: end;
            width: 30%;
            margin-right: 2rem;
        }
        .addbutton{
            align-items: flex-end;
            width: 30%;
            }
</style>


<div class="page-body">
<!-- tracking table start -->
<div class="container-fluid">

        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12" id="printableArea">
                    <div class="card card-table">
                        <div class="title-header option-title">
                            <h2>Ledger Details</h2>
                            <div class="d-inline-flex hide-on-print">
                                <button class="btn btn-primary text-white print-button rounded ms-2" onclick="printInvoice()" > Print </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive table-product">
                                <table class="table all-package theme-table" id="table_id">
                                    <thead>
                                        <tr>
                                            <th style="text-align: center;">Name</th>
                                            <th style="text-align: center;">Date</th>
                                            <th style="text-align: center;">Amount</th>                                            
                                        </tr>
                                    </thead>

                                    <tbody>
                                        
                                            <% if (data != '') { %>
                                                <tr>
                                                    <td style="text-align: center;"><%= data.client_id.name %></td>
                                                    <td style="text-align: center;">
                                                        <%= data.date %>
                                                    </td>
                                                    <td style="text-align: center;"><%= (data.amount).toFixed(2) %></td>
                                                </tr>
                                            <% }else{ %>
                                                <tr>
                                                    <td colspan="7" class="text-center">No Transactions Available</td>
                                                </tr>
                                            <% } %>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card card-table">
                        <div class="card-body">
                            <div class="title-header option-title">
                                <h2>Invoice</h2>
                            </div>
                            <div class="table-responsive table-product">
                                <table class="table all-package theme-table" id="table_id">
                                    <thead>
                                        <tr>
                                            <th style="text-align: center;">Date</th>
                                            <th style="text-align: center;">Order Id</th>
                                            <th style="text-align: center;">Total Amount</th>                                            
                                        </tr>
                                    </thead>

                                    <tbody>
                                        
                                            <% if (bills != '') { %>
                                                <% bills.forEach((row, index) => { %>
                                                    <tr>
                                                        <td style="text-align: center;"><%= row.created_date.toLocaleDateString('en-UK',options) %></td>
                                                        <td style="text-align: center;">
                                                            <a href="/admin/order/order-summary/<%= row.order_id %>">
                                                                <%= row.order_id %>
                                                            </a>
                                                        </td>
                                                        <td style="text-align: center;"><%= (parseFloat(row.amount)).toFixed(2) %></td>
                                                    </tr>
                                                <% }) %>
                                            <% }else{ %>
                                                <tr>
                                                    <td colspan="7" class="text-center">No Transactions Available</td>
                                                </tr>
                                            <% } %>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card card-table">
                        <div class="card-body">
                            <div class="table-responsive table-product">
                                <table class="table all-package theme-table" id="table_id">
                                    <div class="title-header option-title">
                                        <h2>Transaction History</h2>
                                    </div>
                                    <thead>
                                        <tr>
                                            <th style="text-align: center;">Date</th>
                                            <th style="text-align: center;">Type</th>
                                            <th style="text-align: center;">Name</th> 
                                            <th style="text-align: center;">Credit</th>
                                            <th style="text-align: center;">Debit</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        
                                            <% if (transactions!= '') { %>
                                                <% transactions.forEach((row, index) => { %>
                                                    <tr>
                                                        <td style="text-align: center;"><%= row.date %></td>
                                                        <td style="text-align: center;"><%= row.from %></td>
                                                        <td style="text-align: center;"><%= row.to %></td>
                                                        <td style="text-align: center;"><%= (parseFloat(row.credited)).toFixed(2) %></td>
                                                        <td style="text-align: center;"><%= (parseFloat(row.debited)).toFixed(2) %></td>
                                                    </tr>
                                                <% }) %>
                                            <% }else{ %>
                                                <tr>
                                                    <td colspan="7" class="text-center">No Transactions Available</td>
                                                </tr>
                                            <% } %>
                                        
                                    </tbody>
                                </table>
                                <br>
                                <br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

</div>
<!-- tracking table end -->

<div class="container-fluid">
    <!-- footer start-->
    <%- include('../../partials/footer')%>
</div>
</div>


<script>
    $(document).ready(function() {
        // Add click event listener to the continue button
        $('.continue-btn').click(function() {
            // Show the table content
            $('.hide-table').show();

            // Get the active tab pane
            var activeTabPane = $('.tab-pane.active');
            // Find the next tab pane
            var nextTabPane = activeTabPane.next('.tab-pane');

            // Check if there is a next tab pane
            if (nextTabPane.length > 0) {
                // Hide the current tab pane
                activeTabPane.removeClass('show active');
                // Show the next tab pane
                nextTabPane.addClass('show active');
            }
        });
    });
</script>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> 
<script>
    function printInvoice() {
        // Hide elements that should not be printed
        const elementsToHide = document.querySelectorAll('.hide-on-print');
        elementsToHide.forEach((element) => {
            element.style.display = 'none';
        });
        
        // Get the content within the printable area
        const printableArea = document.getElementById('printableArea');
        const tableContent = printableArea.innerHTML; // Get the table content
        
        // Open a new window for printing
        const printWindow = window.open('', '', 'width=800,height=600');
        printWindow.document.open();
        printWindow.document.write('<html><head><style>table, th, td {border: .5px solid black;padding : 2px;} *{font-size:10px}</style></head><body>');
        printWindow.document.write(tableContent); // Write the table content
        printWindow.document.write('</body></html');
        printWindow.document.close();
        
        // Print the content
        printWindow.print();
        
        // Close the print window
        printWindow.close();
        
        // Restore the hidden elements after printing is done
        elementsToHide.forEach((element) => {
            element.style.display = '';
        });
    }
        
</script>


<script>
    function validateFloat(floatField) {
        // Remove any non-numeric characters (including '.') from the input
        floatField.value = floatField.value.replace(/[^0-9.]/g, '');

        // Parse the entered value as a float
        var enteredValue = parseFloat(floatField.value);

        // Display an error message if the entered value is not a valid number or less than or equal to 0
        var errorMessage = document.getElementById("errorMessage");
        if (isNaN(enteredValue) || enteredValue <= 0) {
            errorMessage.textContent = "Please enter a valid number greater than 0.";
            document.getElementById("confirmStatusChange").disabled = true;
        } else {
            errorMessage.textContent = "";
            document.getElementById("confirmStatusChange").disabled = false;
        }
    }
</script>


<script>
    // Update Total Area
    function updateTotalArea() {
        var width = parseFloat(document.getElementById('width').value) || 0; // Default to 1 if width is 0
        var height = parseFloat(document.getElementById('height').value) || 0; // Default to 1 if height is 0
        var quantity = parseFloat(document.getElementById('quantity').value) || 0;
        var total_area = (width * height * quantity);
        document.getElementById('total_area').value = total_area;
    }

    // Update Total Amount
    function updateTotalAmount() {
        var width = parseFloat(document.getElementById('width').value) || 1; // Default to 1 if width is 0
        var height = parseFloat(document.getElementById('height').value) || 1; // Default to 1 if height is 0
        var quantity = parseFloat(document.getElementById('quantity').value) || 0;
        var rate = parseFloat(document.getElementById('rate').value) || 0;
        var total_amount = (width * height * quantity * rate);
        document.getElementById('total_amount').value = total_amount;
    }

    // Update Rate
    function updateRate() {
        var width = parseFloat(document.getElementById('width').value) || 1; // Default to 1 if width is 0
        var height = parseFloat(document.getElementById('height').value) || 1; // Default to 1 if height is 0
        var quantity = parseFloat(document.getElementById('quantity').value) || 0;
        var amount = parseFloat(document.getElementById('total_amount').value) || 0;
        var rate = (amount / (width * height * quantity));
        document.getElementById('rate').value = rate;
    }

    // Event listeners for input fields
    document.getElementById('width').addEventListener('input', updateTotalArea);
    document.getElementById('height').addEventListener('input', updateTotalArea);
    document.getElementById('quantity').addEventListener('input', updateTotalArea);

    document.getElementById('width').addEventListener('input', updateTotalAmount);
    document.getElementById('height').addEventListener('input', updateTotalAmount);
    document.getElementById('quantity').addEventListener('input', updateTotalAmount);
    document.getElementById('rate').addEventListener('input', updateTotalAmount);

    document.getElementById('width').addEventListener('input', updateRate);
    document.getElementById('height').addEventListener('input', updateRate);
    document.getElementById('quantity').addEventListener('input', updateRate);
    document.getElementById('total_amount').addEventListener('input', updateRate);
</script>

<script>
    $(document).ready(function() {
        // Add event listener to unit select element
        $('#unit').on('change', function() {
            var unitValue = $(this).val();
            // Check the selected unit value
            if (unitValue === 'SQRFT') {
                console.log("changes to sqrft")
                // Enable width, height, and area inputs
                $('#width, #height, #total_area').prop('disabled', false);
            } else if (unitValue === 'NOS') {
                console.log("changes to nos")
                // Disable width, height, and area inputs
                $('#width, #height, #total_area').prop('disabled', true); 
            }
        });
    });
</script>

<script>
    // Get the dropdown menu
var dropdownMenu = document.getElementById('customerDropdown');

// Get the input fields
var emailInput = document.getElementById('email');
var phoneInput = document.getElementById('phone');
var addressInput = document.getElementById('address');
var customerNameInput = document.getElementById('customerName');
var customerIdInput = document.getElementById('customer_id');
var tokenInput = document.getElementById('token');

// Add an event listener to the dropdown menu
dropdownMenu.addEventListener('click', function(e) {
    // Check if the clicked element is an li element
    if (e.target && e.target.nodeName == 'LI') {
        // Get the selected customer's ID from the value attribute of the clicked li element
        var customerId = e.target.getAttribute('value');

        // Make an API call to fetch the user data based on the customer ID
        fetch('/admin/auth/get-vendor/' + customerId)
            .then(response => response.json())
            .then(data => {
                console.log(data.data.phone)
                console.log(data.data.name)
                console.log(data.data._id)
                // Update the input fields with the fetched user data
                customerIdInput.value = data.data._id;
                customerNameInput.value = data.data.name; 
            })
            .catch(error => console.error('Error fetching customer data:', error));
    }
});

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    var inputField = document.getElementById('customerName');
    var dropdownMenu = document.getElementById('customerDropdown');
    var options = dropdownMenu.getElementsByTagName('li');

    inputField.addEventListener('input', function() {
        var filter = inputField.value.toLowerCase();
        for (var i = 0; i < options.length; i++) {
            var textValue = options[i].textContent || options[i].innerText;
            if (textValue.toLowerCase().indexOf(filter) > -1) {
                options[i].style.display = "";
            } else {
                options[i].style.display = "none";
            }
        }
    });

    inputField.addEventListener('click', function() {
        toggleDropdown();
    });

    inputField.addEventListener('focus', function() {
        toggleDropdown();
    });

    dropdownMenu.addEventListener('click', function(event) {
        if (event.target.tagName === 'LI') {
            inputField.value = event.target.textContent;
            toggleDropdown();
        }
    });

    function toggleDropdown() {
        if (dropdownMenu.style.display === 'none') {
            dropdownMenu.style.display = 'block';
        } else {
            dropdownMenu.style.display = 'none';
        }
    }
    });

</script>
<%- include('../../partials/end')%>

